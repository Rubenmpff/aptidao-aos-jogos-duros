// script.js - Gera perguntas, calcula pontua√ß√£o, mostra resultado e ranking

const perguntas = [
  // (perguntas como j√° listaste acima... mantemos o conte√∫do existente)
  // Certifica-te que cada pergunta tem estrutura correta: { pergunta: "...", opcoes: ["op√ß√£o1", ...] }
  {
    pergunta: "O que fazes quando o jogo dura mais de 4 horas?",
    opcoes: [
      "Fujo sem dizer nada",
      "Ligo a dizer que estou bem",
      "Trago snacks e mantas",
      "Aceito o destino e jogo mais"
    ]
  },
  {
    pergunta: "Algu√©m abre o segundo pack de minis. Tu...",
    opcoes: [
      "Dizes que vais s√≥ ver",
      "Bebes e esqueces as regras",
      "Jogas melhor (dizes tu)",
      "Bebes, jogas e ganhas com gritos"
    ]
  },
  {
    pergunta: "Se servem nachos com queijo no meio do jogo:",
    opcoes: [
      "Limpo as m√£os ao tabuleiro",
      "Como com uma pe√ßa de jogo",
      "Paro e como com classe",
      "Trago talheres e guardanapos"
    ]
  },
  {
    pergunta: "Jogar depois de 2 copos:",
    opcoes: [
      "N√£o jogo. J√° estou confuso",
      "Fa√ßo piadas com as cartas",
      "Grito ‚ÄúEUROGAME!‚Äù e sigo",
      "Explico regras com sotaque russo"
    ]
  },
  {
    pergunta: "Qual o teu plano alimentar para uma sess√£o longa?",
    opcoes: [
      "Nenhum. Morro a meio",
      "Chips e sorte",
      "Comida fria e f√°cil",
      "Refei√ß√£o por turnos e termos"
    ]
  },
  {
    pergunta: "Como defines ‚Äúdivers√£o‚Äù num jogo duro e b√™bado?",
    opcoes: [
      "Gritar sem saber porqu√™",
      "Lan√ßar dados e beber",
      "Sobreviver sem cair",
      "Jogar 4 horas e lembrar tudo"
    ]
  },
  {
    pergunta: "Quando algu√©m derruba cerveja no tabuleiro:",
    opcoes: [
      "Choro e saio",
      "Rodo a mesa",
      "Grito ‚Äúlimpeza fase b√¥nus!‚Äù",
      "Tenho sleeves, panos e √°lcool a postos"
    ]
  },
  {
    pergunta: "Que bebes quando jogas?",
    opcoes: [
      "√Ågua com medo",
      "Vinho com classe",
      "Cerveja de litro",
      "Qualquer coisa em shot"
    ]
  },
  {
    pergunta: "Quantos jogos lembras-te de ter jogado completamente s√≥brio?",
    opcoes: [
      "Todos",
      "Alguns",
      "Um‚Ä¶ talvez",
      "Nenhum. √â tradi√ß√£o"
    ]
  },
  {
    pergunta: "Jogar com snacks na mesa √©:",
    opcoes: [
      "Crime",
      "Toler√°vel",
      "Inevit√°vel",
      "Essencial"
    ]
  },
  {
    pergunta: "Se te oferecem mais uma bebida no meio do jogo:",
    opcoes: [
      "Recuso",
      "Aceito e bebo devagar",
      "Aceito e jogo mais feliz",
      "Bebo, jogo e explico regras aos outros"
    ]
  },
  {
    pergunta: "Ao fim da segunda ronda de bebida:",
    opcoes: [
      "N√£o sei quem sou",
      "Fa√ßo equipas aleat√≥rias",
      "Come√ßo a gritar ‚ÄúMeeple!‚Äù",
      "Jogo em modo autom√°tico e ganho"
    ]
  },
  {
    pergunta: "A tua rela√ß√£o com comida e componentes √©:",
    opcoes: [
      "Inexistente. Tenho trauma",
      "Eu como‚Ä¶ e pe√ßo desculpa",
      "Tudo bem desde que limpe",
      "Uso sleeves, bases, tampas e tupperwares"
    ]
  },
  {
    pergunta: "O que √© pior?",
    opcoes: [
      "Um jogo dif√≠cil",
      "Um jogo longo",
      "Um jogo sem snacks",
      "Um jogo sem bebida"
    ]
  },
  {
    pergunta: "Quantas vezes j√° jogaste ‚Äúcom algum copo a mais‚Äù?",
    opcoes: [
      "Nunca",
      "Algumas",
      "Perdi a conta",
      "Agora mesmo"
    ]
  },
  {
    pergunta: "Preferes jogos com...",
    opcoes: [
      "Poucas pe√ßas e sil√™ncio",
      "M√∫sica de fundo e cerveja",
      "Debate aceso e vinho",
      "Barulho, comida e caos total"
    ]
  },
  {
    pergunta: "Em festas levas:",
    opcoes: [
      "Nada",
      "Um baralho de UNO",
      "Um party game",
      "Um eurogame e um abridor"
    ]
  },
  {
    pergunta: "Jogar enquanto se bebe √©:",
    opcoes: [
      "Um erro",
      "Um risco",
      "Uma b√™n√ß√£o",
      "A √∫nica maneira de viver"
    ]
  },
  {
    pergunta: "Se jogares com gente b√™bada:",
    opcoes: [
      "Desisto",
      "Vou atr√°s",
      "Sigo com humor",
      "Assumo controlo da partida"
    ]
  },
  {
    pergunta: "Depois de tudo, jogas melhor:",
    opcoes: [
      "S√≥brio",
      "Com um copo",
      "Meio torto",
      "Quando nem sei quem sou"
    ]
  },
  {
  pergunta: "Quantos copos precisas para achar que sabes todas as regras?",
  opcoes: [
    "Zero. Sou um mestre",
    "Dois. A confian√ßa vem",
    "Tr√™s. Fa√ßo regras novas",
    "Mais de tr√™s. Sou uma lenda viva"
  ]
},
{
  pergunta: "Durante o setup, tu:",
  opcoes: [
    "Reclamas do tempo",
    "Montas enquanto bebes",
    "Misturas pe√ßas com snacks",
    "Bebes e finges que j√° est√° tudo pronto"
  ]
},
{
  pergunta: "Se algu√©m baralha mal as cartas:",
  opcoes: [
    "Fico calado e sofro",
    "Comento com ironia",
    "Tomo o baralho √† for√ßa",
    "Beber resolve"
  ]
},
{
  pergunta: "Qual √© o teu grito de vit√≥ria?",
  opcoes: [
    "Nenhum. S√≥ aceno",
    "Um simples 'YES'",
    "‚ÄúComi-vos todos!‚Äù",
    "‚ÄúEU NASCI PARA ISTO!‚Äù"
  ]
},
{
  pergunta: "Jogar com ressaca √©:",
  opcoes: [
    "Imposs√≠vel",
    "Uma tortura aceit√°vel",
    "Uma tradi√ß√£o de s√°bado",
    "Meu estado natural"
  ]
},
{
  pergunta: "Teu grupo traz bebidas para jogar. Tu trazes:",
  opcoes: [
    "Nada",
    "√Ågua e vergonha",
    "Uma garrafinha para fingir",
    "Uma geleira com tudo"
  ]
},
{
  pergunta: "Como te preparas para um jogo dif√≠cil?",
  opcoes: [
    "N√£o me preparo",
    "Vejo v√≠deo de regras",
    "Leio o manual com vinho",
    "Durmo bem, bebo caf√© e levo cerveja"
  ]
},
{
  pergunta: "J√° ensinaste regras... b√™bado?",
  opcoes: [
    "Nunca, sou respons√°vel",
    "Talvez uma vez",
    "Com orgulho",
    "E ganhei!"
  ]
},
{
  pergunta: "Qual o limite entre divers√£o e caos?",
  opcoes: [
    "2 copos",
    "1 erro de regra",
    "Quando algu√©m grita 'onde est√° o manual'",
    "N√£o existe limite"
  ]
},
{
  pergunta: "Qual teu papel em jogos de grupo?",
  opcoes: [
    "Observador",
    "O que distribui comida",
    "O b√™bado barulhento",
    "O b√™bado que ganha"
  ]
},
{
  pergunta: "O que te faz rir no meio do jogo?",
  opcoes: [
    "Piadas secas",
    "Jogadas absurdas",
    "Regras esquecidas",
    "O facto de ainda estar a jogar"
  ]
},
{
  pergunta: "Qual tua postura ao jogar b√™bado?",
  opcoes: [
    "Cautelosa",
    "Criativa",
    "Altamente improvisada",
    "Sou o caos"
  ]
},
{
  pergunta: "Jogas mais s√©rio quando:",
  opcoes: [
    "H√° pr√©mio",
    "√â jogo novo",
    "Estou um pouco alterado",
    "Nunca jogo s√©rio"
  ]
},
{
  pergunta: "Quando uma pe√ßa cai no ch√£o:",
  opcoes: [
    "Ignoro",
    "Sento no ch√£o e rio",
    "Atribuo penaliza√ß√£o",
    "Brindo √† gravidade"
  ]
},
{
  pergunta: "Quantas bebidas at√© o UNO parecer complexo?",
  opcoes: [
    "5",
    "3",
    "2 e um shot",
    "Uma, se for tequila"
  ]
},
{
  pergunta: "Quem decide o primeiro jogador?",
  opcoes: [
    "O s√≥brio",
    "O que trouxe bebida",
    "O mais barulhento",
    "O que j√° come√ßou a jogar sozinho"
  ]
},
{
  pergunta: "O que pensas de jogos com aplica√ß√£o?",
  opcoes: [
    "√öteis",
    "Distrativos",
    "Perigosos com √°lcool",
    "Eu sou a app agora"
  ]
},
{
  pergunta: "O que te faz perder a paci√™ncia num jogo?",
  opcoes: [
    "Regra esquecida",
    "Comida nas cartas",
    "Jogador lento",
    "Falta de bebida"
  ]
},
{
  pergunta: "Quando h√° uma pausa no jogo, tu:",
  opcoes: [
    "Rezo por pontos",
    "Vou buscar bebida",
    "Disfar√ßo que entendi tudo",
    "Explico as regras inventadas"
  ]
},
{
  pergunta: "Depois de 5 horas de jogo tu:",
  opcoes: [
    "Desmaio",
    "Pe√ßo pizza",
    "Troco de equipa",
    "Sugiro mais um"
  ]
}
];

let perguntaAtual = 0;
let respostasSelecionadas = [];

function mostrarPergunta(index) {
  const container = document.getElementById("pergunta-container");
  container.innerHTML = "";

  const perguntaObj = perguntas[index];

  const label = document.createElement("label");
  label.htmlFor = `pergunta${index}`;
  label.textContent = `üéØ ${perguntaObj.pergunta}`;

  const select = document.createElement("select");
  select.id = `pergunta${index}`;
  select.required = true;

  const defaultOption = document.createElement("option");
  defaultOption.disabled = true;
  defaultOption.selected = true;
  defaultOption.value = "";
  defaultOption.textContent = "Escolhe uma op√ß√£o...";
  select.appendChild(defaultOption);

  perguntaObj.opcoes.forEach((opcao, idx) => {
    const option = document.createElement("option");
    option.value = idx;
    option.textContent = opcao;
    select.appendChild(option);
  });

  container.appendChild(label);
  container.appendChild(select);
}

function atualizarProgresso() {
  const barra = document.getElementById("barra-progresso");
  barra.value = perguntaAtual;
  barra.max = perguntas.length;
}

document.getElementById("btn-proximo").addEventListener("click", () => {
  const nome = document.getElementById("nome").value.trim();
  if (!nome) {
    alert("Por favor, preenche o teu Nome de guerra antes de come√ßares.");
    document.getElementById("nome").focus();
    return;
  }

  const select = document.querySelector("select");
  if (!select || select.value === "") {
    alert("Escolhe uma op√ß√£o antes de continuar.");
    return;
  }

  if (perguntaAtual === 0) {
    document.getElementById("nome").parentElement.style.display = "none";
  }

  respostasSelecionadas.push(parseInt(select.value));
  perguntaAtual++;

  if (perguntaAtual < perguntas.length) {
    mostrarPergunta(perguntaAtual);
    atualizarProgresso();
  } else {
    document.getElementById("btn-proximo").classList.add("hidden");
    document.getElementById("btn-finalizar").classList.remove("hidden");
    atualizarProgresso();
  }
});

document.getElementById("quiz-form").addEventListener("submit", function (e) {
  e.preventDefault();

  const nome = document.getElementById("nome").value.trim();
  if (nome === "") return;

  const total = respostasSelecionadas.reduce((acc, val) => acc + val, 0);

  let resultadoTexto = "";
  let selo = "";

  if (total <= 20) {
    resultadoTexto = "üê£ Jogador Piu-Piu";
    selo = "‚ùå N√£o est√° apto a sofrer com jogos DUROS.";
  } else if (total <= 35) {
    resultadoTexto = "üç∑ Jogador Casual";
    selo = "‚ö†Ô∏è Semi-apto.";
  } else if (total <= 50) {
    resultadoTexto = "üç∫ Jogador de Elite Et√≠lico";
    selo = "‚úÖ Apto.";
  } else {
    resultadoTexto = "üß† Lend√°rio";
    selo = "üèÖ ALTAMENTE APTO.";
  }

  document.getElementById("resultado").innerHTML = `
    <h2>${resultadoTexto}</h2>
    <p><strong>Pontua√ß√£o total:</strong> ${total} pontos</p>
    <p>${selo}</p>
  `;
  document.getElementById("resultado").classList.remove("hidden");

  saveToFirebase(nome, total);
  carregarRanking();
});

function carregarRanking() {
  db.collection("respostas")
    .orderBy("pontuacao", "desc")
    .limit(20)
    .get()
    .then((querySnapshot) => {
      const lista = document.getElementById("ranking-list");
      lista.innerHTML = "";

      let separadorInserido = false;
      let posicao = 1;

      querySnapshot.forEach((doc) => {
        const dados = doc.data();
        const nome = dados.nome;
        const pontos = parseInt(dados.pontuacao);

        let medalha = "";
        if (posicao === 1) medalha = "ü•á";
        else if (posicao === 2) medalha = "ü•à";
        else if (posicao === 3) medalha = "ü•â";

        let emoji = pontos < 10 ? "üò≠" : "üß†";

        if (!separadorInserido && pontos < 36) {
          const separador = document.createElement("li");
          separador.innerHTML = `<hr><strong style="color:#999;">üîª Abaixo desta linha: jogadores n√£o aptos</strong>`;
          lista.appendChild(separador);
          separadorInserido = true;
        }

        const item = document.createElement("li");
        item.innerHTML = `${medalha} #${posicao} - ${nome} ${emoji} (${pontos} pts)`;
        lista.appendChild(item);
        posicao++;
      });
    })
    .catch((error) => {
      console.error("Erro ao carregar ranking:", error);
    });
}

function saveToFirebase(nome, pontuacao) {
  const dbRef = db.collection("respostas").doc(nome);

  dbRef.set({ nome, pontuacao, timestamp: new Date() })
    .then(() => {
      console.log("‚úÖ Pontua√ß√£o salva com sucesso.");
    })
    .catch((error) => {
      console.error("Erro ao salvar pontua√ß√£o:", error);
    });
}

// Inicializar
mostrarPergunta(perguntaAtual);
atualizarProgresso();